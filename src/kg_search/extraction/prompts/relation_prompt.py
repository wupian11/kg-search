"""
关系抽取提示词模板

针对文博领域优化的关系抽取提示词（支持台湾文物数据）
"""

# ============================================================
# 关系类型定义 - 台湾文物领域
# ============================================================

RELATION_TYPES = """
## 核心关系类型

### 时间关系
- 属于年代: 文物属于某个年代（source: 文物 → target: 年代）
  示例: 臺灣野球史 -[属于年代]-> 西元1932年
- 属于朝代: 文物属于某个历史时期（source: 文物 → target: 朝代）
  示例: 淡北育嬰堂碑 -[属于朝代]-> 清代

### 地理关系
- 位于: 文物/机构所在的行政区（source: 文物/机构 → target: 行政区）
  示例: 臺灣野球史 -[位于]-> 嘉義市東區
- 地址为: 具体的街道地址（source: 文物/机构 → target: 地址）
  示例: 嘉義市立博物館 -[地址为]-> 忠孝路275號
- 出土于: 考古文物的出土地点（source: 文物 → target: 出土地点）

### 材质工艺关系
- 材质为: 文物的制作材料（source: 文物 → target: 材质）
  示例: 臺灣野球史 -[材质为]-> 紙質
- 工艺为: 文物的制作工艺（source: 文物 → target: 工艺）
  示例: 孫中山銅像 -[工艺为]-> 鑄造
- 尺寸为: 文物的规格尺寸（source: 文物 → target: 尺寸）

### 收藏保管关系
- 保管于: 文物由某单位保管（source: 文物 → target: 保管单位）
  示例: 臺灣野球史 -[保管于]-> 財團法人嘉義市文化基金會
- 存放于: 文物存放的空间类型（source: 文物 → target: 存放空间）
  示例: 臺灣野球史 -[存放于]-> 博物館
- 收藏于: 文物被某机构收藏（source: 文物 → target: 收藏机构）

### 登录管理关系
- 登录于: 文物由某政府机关公告登录（source: 文物 → target: 公告机关）
  示例: 臺灣野球史 -[登录于]-> 嘉義市政府
- 主管为: 文物的业务主管单位（source: 文物 → target: 主管机关）
  示例: 臺灣野球史 -[主管为]-> 嘉義市政府文化局
- 依据法规: 登录依据的法律条文（source: 文物 → target: 法规）
  示例: 臺灣野球史 -[依据法规]-> 文化資產保存法第65條

### 分类关系
- 属于资产类型: 文物的分类（source: 文物 → target: 资产类型）
  示例: 臺灣野球史 -[属于资产类型]-> G3.1圖書、報刊
- 属于资产等级: 文物的等级分类（source: 文物 → target: 资产等级）
  示例: 臺灣野球史 -[属于资产等级]-> 一般古物
- 符合标准: 文物符合的判定标准（source: 文物 → target: 判定标准）
  示例: 臺灣野球史 -[符合标准]-> 具有珍貴及稀有性者

### 人物关系
- 创作者: 文物由某人创作（source: 文物 → target: 人物）
  示例: 孫中山銅像 -[创作者]-> 蒲添生
- 相关人物: 文物与某历史人物相关（source: 文物 → target: 人物）
  示例: 孫中山銅像 -[相关人物]-> 孫中山
- 捐赠者: 文物由某人捐赠（source: 文物 → target: 人物）

### 来源关系
- 来源方式: 文物的取得方式（source: 文物 → target: 来源方式）
  示例: 臺灣野球史 -[来源方式]-> 購藏(徵集)

### 相似关系（基于属性规则）
- 同年代: 两个文物属于同一年代（双向关系）
  规则: 当两文物的year_ce差距≤10年
- 同材质: 两个文物材质相同（双向关系）
  规则: 当两文物的材质字段完全匹配
- 同类型: 两个文物属于同一资产类型（双向关系）
  规则: 当两文物的assetsTypes.subCode相同
- 同区域: 两个文物位于同一行政区（双向关系）
  规则: 当两文物的cityName相同
- 同保管: 两个文物由同一单位保管（双向关系）
  规则: 当两文物的keepDepts.name相同
"""

# 简体中文版本
RELATION_TYPES_SIMPLIFIED = """
## 核心关系类型

### 时间关系
- 属于年代: 文物属于某个年代
- 属于朝代: 文物属于某个历史时期

### 地理关系
- 位于: 文物/机构所在的行政区
- 地址为: 具体的街道地址
- 出土于: 考古文物的出土地点

### 材质工艺关系
- 材质为: 文物的制作材料
- 工艺为: 文物的制作工艺
- 尺寸为: 文物的规格尺寸

### 收藏保管关系
- 保管于: 文物由某单位保管
- 存放于: 文物存放的空间类型
- 收藏于: 文物被某机构收藏

### 登录管理关系
- 登录于: 文物由某政府机关公告登录
- 主管为: 文物的业务主管单位
- 依据法规: 登录依据的法律条文

### 分类关系
- 属于资产类型: 文物的分类
- 属于资产等级: 文物的等级分类
- 符合标准: 文物符合的判定标准

### 人物关系
- 创作者: 文物由某人创作
- 相关人物: 文物与某历史人物相关
- 捐赠者: 文物由某人捐赠

### 来源关系
- 来源方式: 文物的取得方式

### 相似关系
- 同年代/同材质/同类型/同区域/同保管
"""

# ============================================================
# 关系抽取提示词模板
# ============================================================

RELATION_EXTRACTION_PROMPT = """你是一个专业的文博领域知识抽取专家，专精于台湾文化资产数据处理。请从以下文本中提取实体之间的关系。

## 关系类型说明
{relation_types}

## 已识别的实体
{entities}

## 输入文本
{text}

## 输出要求
请以JSON格式输出提取的关系，格式如下：
{{
    "relations": [
        {{
            "source_entity": "源实体名称",
            "source_type": "源实体类型",
            "target_entity": "目标实体名称",
            "target_type": "目标实体类型",
            "relation_type": "关系类型（从上述类型中选择）",
            "description": "关系的简要描述",
            "source_field": "来源字段名（用于溯源）",
            "confidence": 0.95
        }}
    ]
}}

## 特殊处理规则

### 相似关系的构建
相似关系应基于以下属性规则自动构建（无需从文本抽取）：
- 同年代: year_ce差距≤10年
- 同材质: 材质字段完全匹配
- 同类型: assetsTypes.subCode相同
- 同区域: cityName相同
- 同保管: keepDepts.name相同

### 关系方向
- 大多数关系是有向的：source_entity是主体（通常是文物），target_entity是客体
- 相似关系是双向的：需要创建两条记录（A→B 和 B→A）

## 注意事项
1. 只提取实体列表中存在的实体之间的关系
2. 关系必须是文本中明确或隐含表达的
3. source_field用于结果溯源，标注关系来自原始数据的哪个字段
4. confidence表示提取的置信度，范围0-1
5. 确保输出是有效的JSON格式

请开始提取："""

# ============================================================
# 结构化字段直接映射的关系抽取模板
# ============================================================

STRUCTURED_RELATION_EXTRACTION_PROMPT = """你是一个专业的文博领域知识抽取专家。请从以下描述性文本中补充提取实体之间的关系。

注意：大部分关系已从结构化字段直接映射获得。
你的任务是从描述性文本（registerReason, reserveStatusDesc）中发现额外的隐含关系。

## 已从结构化字段提取的关系
{existing_relations}

## 已识别的实体
{entities}

## 需要分析的描述性文本
{description_text}

## 关系类型说明
{relation_types}

## 输出要求
只输出从描述文本中**新发现**的关系，不要重复已提取的关系。
格式同上。

请开始提取："""

# ============================================================
# 关系权重配置（用于混合检索）
# ============================================================

RELATION_WEIGHTS = {
    # 核心关系（高权重）
    "属于年代": 1.0,
    "属于资产类型": 1.0,
    "材质为": 0.9,
    "位于": 0.9,
    "保管于": 0.8,
    # 重要关系（中权重）
    "创作者": 0.8,
    "登录于": 0.7,
    "存放于": 0.7,
    "符合标准": 0.6,
    # 辅助关系（低权重）
    "来源方式": 0.5,
    "依据法规": 0.4,
    "尺寸为": 0.3,
    # 相似关系（可配置权重）
    "同年代": 0.8,
    "同材质": 0.7,
    "同类型": 0.9,
    "同区域": 0.6,
    "同保管": 0.5,
}
