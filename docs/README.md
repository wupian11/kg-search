# KG-Search: æ–‡åšé¢†åŸŸæ™ºèƒ½æ£€ç´¢ç³»ç»Ÿ

åŸºäº **GraphRAG** å’Œ **å‘é‡æ•°æ®åº“** çš„æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿï¼Œä¸“ä¸ºæ–‡åšé¢†åŸŸæ•°å­—æ–‡ç‰©åº“è®¾è®¡ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ” **æ··åˆæ£€ç´¢**: ç»“åˆå‘é‡ç›¸ä¼¼åº¦æœç´¢å’ŒçŸ¥è¯†å›¾è°±éå†
- ğŸ§  **GraphRAG**: æ”¯æŒ Local Searchï¼ˆå®ä½“å…³è”æ£€ç´¢ï¼‰å’Œ Global Searchï¼ˆç¤¾åŒºæ‘˜è¦æ£€ç´¢ï¼‰
- ğŸ“Š **çŸ¥è¯†å›¾è°±**: è‡ªåŠ¨æå–æ–‡ç‰©å®ä½“å’Œå…³ç³»ï¼Œæ„å»ºé¢†åŸŸçŸ¥è¯†å›¾è°±
- ğŸ—„ï¸ **åŒå­˜å‚¨**: ChromaDB å‘é‡å­˜å‚¨ + Neo4j å›¾æ•°æ®åº“
- ğŸ“„ **å¤šæ ¼å¼æ”¯æŒ**: JSON/JSONL/Markdown/TXT æ–‡æ¡£è§£æ
- ğŸš€ **APIæœåŠ¡**: FastAPI RESTful APIï¼Œæ”¯æŒ API Key è®¤è¯
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**: Docker Compose ä¸€é”®éƒ¨ç½²

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Gateway                          â”‚
â”‚                    (FastAPI + Uvicorn)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Retrieval Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Vector  â”‚  â”‚  Graph   â”‚  â”‚   Local    â”‚  â”‚  Global  â”‚ â”‚
â”‚  â”‚ Retrieverâ”‚  â”‚ Retrieverâ”‚  â”‚   Search   â”‚  â”‚  Search  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Storage Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ChromaDB   â”‚    â”‚    Neo4j     â”‚   â”‚  Document    â”‚  â”‚
â”‚  â”‚  (Vectors)   â”‚    â”‚   (Graph)    â”‚   â”‚   Store      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Extraction Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Entity     â”‚  â”‚   Relation   â”‚  â”‚   Graph Builder  â”‚ â”‚
â”‚  â”‚  Extractor   â”‚  â”‚  Extractor   â”‚  â”‚  (Community Det.)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Ingestion Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Loaders   â”‚  â”‚   Chunkers   â”‚  â”‚    Pipeline      â”‚ â”‚
â”‚  â”‚ (JSON/MD/TXT)â”‚  â”‚  (Semantic)  â”‚  â”‚                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å®‰è£…

### å‰ç½®è¦æ±‚

- Python 3.11+
- Docker & Docker Compose (æ¨è)
- OpenAI API Key

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/kg-search.git
cd kg-search

# é…ç½®ç¯å¢ƒå˜é‡
cp docker/.env.example docker/.env
# ç¼–è¾‘ docker/.envï¼Œå¡«å…¥ä½ çš„ API Key

# å¯åŠ¨æœåŠ¡
cd docker
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f kg-search
```

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# .venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -e .

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# å¯åŠ¨ Neo4jï¼ˆéœ€è¦å•ç‹¬å®‰è£…æˆ–ä½¿ç”¨ Dockerï¼‰
docker run -d \
    --name neo4j \
    -p 7474:7474 -p 7687:7687 \
    -e NEO4J_AUTH=neo4j/password \
    neo4j:5.17.0

# åˆå§‹åŒ–æ•°æ®åº“
python scripts/init_neo4j.py

# å¯åŠ¨APIæœåŠ¡
kg-search
# æˆ–
uvicorn kg_search.api.main:app --reload
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥ç¤ºä¾‹æ•°æ®

```bash
# åˆ›å»ºç¤ºä¾‹æ–‡ç‰©æ•°æ®
python scripts/seed_data.py

# æ„å»ºç´¢å¼•
python scripts/build_index.py --data-dir ./data/raw
```

### 2. ä½¿ç”¨API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æœç´¢æ–‡ç‰©
curl -X POST http://localhost:8000/api/v1/search \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"query": "å•†ä»£é’é“œå™¨", "top_k": 5}'

# é—®ç­”
curl -X POST http://localhost:8000/api/v1/ask \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"query": "å››ç¾Šæ–¹å°Šæ˜¯ä»€ä¹ˆæœä»£çš„ï¼Ÿ"}'

# Local Search (å®ä½“å…³è”æ£€ç´¢)
curl -X POST http://localhost:8000/api/v1/search/local \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"query": "å››ç¾Šæ–¹å°Š", "entity_types": ["æ–‡ç‰©"]}'

# Global Search (ç¤¾åŒºæ‘˜è¦æ£€ç´¢)
curl -X POST http://localhost:8000/api/v1/search/global \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"query": "å•†ä»£é’é“œè‰ºæœ¯çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"}'
```

### 3. å¯¼å…¥è‡ªå®šä¹‰æ•°æ®

æ”¯æŒçš„æ•°æ®æ ¼å¼ï¼š

**åµŒå¥—JSONæ ¼å¼**ï¼ˆæ¨èï¼‰:
```json
{
  "artifacts": [
    {
      "id": "artifact_001",
      "basic_info": {
        "name": "æ–‡ç‰©åç§°",
        "dynasty": "æœä»£"
      },
      "physical_info": {
        "material": "æè´¨",
        "technique": "å·¥è‰º"
      },
      "description": "è¯¦ç»†æè¿°..."
    }
  ]
}
```

**JSONLæ ¼å¼**:
```jsonl
{"id": "001", "name": "æ–‡ç‰©åç§°", "description": "æè¿°..."}
{"id": "002", "name": "æ–‡ç‰©åç§°2", "description": "æè¿°..."}
```

**Markdownæ ¼å¼**:
```markdown
# æ–‡ç‰©åç§°

## åŸºæœ¬ä¿¡æ¯
- æœä»£ï¼šxxx
- æè´¨ï¼šxxx

## æè¿°
è¯¦ç»†æè¿°...
```

## ğŸ“š APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—®:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### ä¸»è¦ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/v1/ingest/text` | POST | å¯¼å…¥æ–‡æœ¬ |
| `/api/v1/ingest/file` | POST | ä¸Šä¼ æ–‡ä»¶ |
| `/api/v1/search` | POST | æ··åˆæ£€ç´¢ |
| `/api/v1/search/vector` | POST | å‘é‡æ£€ç´¢ |
| `/api/v1/search/graph` | POST | å›¾è°±æ£€ç´¢ |
| `/api/v1/search/local` | POST | Local Search |
| `/api/v1/search/global` | POST | Global Search |
| `/api/v1/ask` | POST | æ™ºèƒ½é—®ç­” |

## âš™ï¸ é…ç½®

ä¸»è¦é…ç½®é¡¹ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼‰ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `API_KEY` | APIè®¤è¯å¯†é’¥ | ç©ºï¼ˆæ— è®¤è¯ï¼‰ |
| `OPENAI_API_KEY` | OpenAI API Key | å¿…å¡« |
| `OPENAI_MODEL` | LLMæ¨¡å‹ | gpt-4o |
| `OPENAI_EMBEDDING_MODEL` | Embeddingæ¨¡å‹ | text-embedding-3-small |
| `NEO4J_URI` | Neo4jè¿æ¥URI | bolt://localhost:7687 |
| `CHUNK_SIZE` | æ–‡æœ¬å—å¤§å° | 1000 |
| `VECTOR_SEARCH_TOP_K` | å‘é‡æ£€ç´¢æ•°é‡ | 10 |
| `GRAPH_SEARCH_DEPTH` | å›¾éå†æ·±åº¦ | 2 |

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_ingestion.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=kg_search --cov-report=html
```

## ğŸ“ å¼€å‘

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"

# ä»£ç æ ¼å¼åŒ–
black src/
isort src/

# ç±»å‹æ£€æŸ¥
mypy src/

# Lint
ruff check src/
```

## ğŸ”§ CLIå·¥å…·

```bash
# å¯åŠ¨APIæœåŠ¡
kg-search [--host 0.0.0.0] [--port 8000] [--reload]

# æ„å»ºç´¢å¼•
kg-build --data-dir ./data/raw [--no-graph] [--no-communities]
```

## ğŸ“Š çŸ¥è¯†å›¾è°±å®ä½“ç±»å‹

- **æ–‡ç‰©** (Artifact): æ–‡ç‰©åç§°ã€æ–‡ç‰©ç¼–å·
- **æœä»£** (Dynasty): æœä»£åç§°
- **å¹´ä»£** (Period): å…·ä½“å¹´ä»£ã€æ—¶é—´èŒƒå›´
- **æè´¨** (Material): åˆ¶ä½œææ–™
- **å·¥è‰º** (Technique): åˆ¶ä½œå·¥è‰ºã€æŠ€æ³•
- **åœ°ç‚¹** (Location): å‡ºåœŸåœ°ç‚¹ã€å‘ç°åœ°
- **æ”¶è—æœºæ„** (Museum): åšç‰©é¦†ã€æ”¶è—å•ä½
- **äººç‰©** (Person): ç›¸å…³å†å²äººç‰©
- **æ–‡åŒ–** (Culture): æ–‡åŒ–ç±»å‹ã€æ–‡æ˜
- **å°ºå¯¸** (Dimension): ç‰©ç†å°ºå¯¸

## ğŸ“Š å…³ç³»ç±»å‹

- å±äºæœä»£ (BELONGS_TO_DYNASTY)
- å±äºå¹´ä»£ (BELONGS_TO_PERIOD)
- å‡ºåœŸäº (EXCAVATED_FROM)
- æ”¶è—äº (COLLECTED_BY)
- æè´¨ä¸º (MADE_OF)
- é‡‡ç”¨å·¥è‰º (USES_TECHNIQUE)
- å…³è”äººç‰© (RELATED_TO_PERSON)
- å±äºæ–‡åŒ– (BELONGS_TO_CULTURE)
- å…·æœ‰å°ºå¯¸ (HAS_DIMENSION)
- ç›¸å…³æ–‡ç‰© (RELATED_ARTIFACT)

## ğŸ“„ License

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!
